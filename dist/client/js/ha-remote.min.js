/*! ha-remote 2016-05-17 */
!function(){"use strict";angular.module("ha-remote.about",["ha-remote.translations"])}(),function(){"use strict";function a(a,b,c){var d=this;a.load().then(function(a){d.copyrightYear=a.copyrightYear,d.copyrightHolders=a.copyrightHolders,d.version=a.version,d.packageInfos=a.modules},function(a){})}angular.module("ha-remote.about").controller("AboutController",["aboutService","$log","$translate",a])}(),function(){angular.module("ha-remote.about").directive("aboutWidget",[function(){return{templateUrl:"src/about/views/about.html",restrict:"E"}}])}(),function(){"use strict";function a(a,b,c){return{load:function(){return b.get("/api").then(function(a){return c.debug("Fetched about info from server"),a.data},function(b){return c.info("Call to "+b.config.url+" failed with status "+b.status),a.reject(b.data)})}}}angular.module("ha-remote.about").service("aboutService",["$q","$http","$log",a])}(),function(){"use strict";function a(a,b,c,d,e){function f(){b("left").toggle()}function g(b){"logout"==b?(a.logout(),i.selected="login"):i.selected=b}function h(){c.debug("Password submitted: %s",i.password),i.loginDisabled=!0,i.loginDisabled=!1,a.login(i.password).then(function(){c.debug("Sucessfull login"),i.password="",i.loginDisabled=!1,i.loginFailed=!1,i.select("panel")},function(a){c.debug("Login failed"),i.password="",i.loginFailed=!0,i.loginDisabled=!1})}var i=this;a.isAuthenticated()?i.selected="panel":i.selected="login",i.toggleMenu=f,i.select=g,i.password="",i.submitPassword=h,i.loginDisabled=!1,i.loginFailed=!1,e.$on("authnFailed",function(){c.debug("Received authnFailed event"),i.selected="login"})}angular.module("ha-remote").controller("AppController",["authnService","$mdSidenav","$log","$translate","$scope",a])}(),function(){"use strict";angular.module("ha-remote",["ngMaterial","ha-remote.panel","ha-remote.translations","ha-remote.authn","ha-remote.about"]),angular.module("ha-remote").config(function(a,b){b.defaultIconSet("./assets/svg/mdi.svg").icon("menu","./assets/svg/menu.svg",24).icon("power-on","./assets/svg/power-on.svg",24).icon("power-off","./assets/svg/power-off.svg",24).icon("logo","./assets/svg/remote-control.svg",12),a.theme("default").primaryPalette("blue").accentPalette("red")})}(),function(){"use strict";function a(a,b,c){return{load:function(){return b.get("/api/config").then(function(a){return c.debug("Fetched configuration from server"),a.data},function(b){return c.info("Call to "+b.config.url+" failed with status "+b.status),a.reject(b.data)})}}}angular.module("ha-remote.panel").service("configService",["$q","$http","$log",a])}(),function(){function a(a,b,c,d,e){function f(c){b.debug("Power on for id: "+c.id+" clicked."),i(),a.powerOn(c.id).then(function(){l.showProgress=!1,d("POWER_ON_SUCCESS",{control_caption:c.caption}).then(function(a){k(a)}),h(),j()},function(){l.showProgress=!1,d("POWER_ON_FAILURE",{control_caption:c.caption}).then(function(a){k(a)}),h(),j()})}function g(c){b.debug("Power off for id: "+c.id+" clicked."),i(),a.powerOff(c.id).then(function(){d("POWER_OFF_SUCCESS",{control_caption:c.caption}).then(function(a){k(a)}),h(),j()},function(){d("POWER_OFF_FAILURE",{control_caption:c.caption}).then(function(a){k(a)}),h(),j()})}function h(){a.getState(l.control.id).then(function(a){switch(a.state){case"on":l.state="state-on";break;case"off":l.state="state-off";break;default:l.state="state-unknown"}b.debug("Set device state of device %s to %s",l.control.caption,l.state)},function(){l.state="unknown",b.debug("Could not get state of device %s setting it to %s",l.control.caption,l.state)})}function i(){e.$emit("showProgress"),b.debug("Emitted showProgress")}function j(){e.$emit("hideProgress"),b.debug("Emitted hideProgress")}function k(a){c.show(c.simple().textContent(a))}var l=this;l.control=e.$parent.control,l.powerOn=f,l.powerOff=g,l.state="state-unknown",h(),e.$on("updateState",h)}angular.module("ha-remote.panel").controller("ControlController",["powerControlService","$log","$mdToast","$translate","$scope",a])}(),function(){angular.module("ha-remote.panel").directive("controlWidget",[function(){return{templateUrl:"src/panel/views/control.html",restrict:"AE",scope:{control:"="}}}])}(),function(){"use strict";angular.module("ha-remote.panel",["ha-remote.translations","window-events"])}(),function(){function a(a,c,d,e,f,g){function h(){d.debug("Power off all clicked."),k(),results=new b(q.controls.length),q.controls.forEach(function(a){c.powerOff(a.id).then(function(){results.addSucess(a),o(results)},function(){results.addFailure(a),o(results)})})}function i(){d.debug("Power on all clicked."),k(),results=new b(q.controls.length),q.controls.forEach(function(a){c.powerOn(a.id).then(function(){results.addSucess(a),p(results)},function(){results.addFailure(a),p(results)})})}function j(){d.debug("PanelController#onWindowFocus"),m()}function k(){g.$emit("showProgress"),d.debug("Emitted showProgress")}function l(){g.$emit("hideProgress"),d.debug("Emitted hideProgress")}function m(){d.debug("PanelController#initUpdateState"),g.$broadcast("updateState")}function n(a){e.show(e.simple().textContent(a))}function o(a){a.isComplete()&&(l(),0==a.failCount()?(f("POWER_OFF_ALL_SUCCESS").then(function(a){n(a)}),m()):(f("POWER_OFF_ALL_FAILURE").then(function(a){n(a)}),m()))}function p(a){a.isComplete()&&(l(),0==a.failCount()?(f("POWER_ON_ALL_SUCCESS").then(function(a){n(a)}),m()):(f("POWER_ON_ALL_FAILURE").then(function(a){n(a)}),m()))}var q=this;q.controls=[],q.showControls=!1,q.showProgress=!0,q.powerOffAll=h,q.powerOnAll=i,q.onWindowFocus=j,a.load().then(function(a){q.controls=a,q.showProgress=!1,q.showControls=!0},function(a){q.showProgress=!1,q.showControls=!1,f("CONFIG_LOAD_FAILED").then(function(a){n(a)})});var r=0;g.$on("showProgress",function(){q.showProgress=!0,r++}),g.$on("hideProgress",function(){r--,0>r&&(r=0),0==r&&(q.showProgress=!1)})}function b(a){this.controlCount=a,this.sucessed=[],this.failed=[]}angular.module("ha-remote.panel").controller("PanelController",["configService","powerControlService","$log","$mdToast","$translate","$scope",a]),b.prototype.isComplete=function(){return this.sucessed.length+this.failed.length>=this.controlCount},b.prototype.failCount=function(){return this.failed.length},b.prototype.sucessCount=function(){return this.sucessed.length},b.prototype.addSucess=function(a){this.sucessed.push(a)},b.prototype.addFailure=function(a){this.failed.push(a)}}(),function(){angular.module("ha-remote.panel").directive("panelWidget",[function(){return{templateUrl:"src/panel/views/panel.html",restrict:"AE"}}])}(),function(){"use strict";function a(a,b,c){return{powerOn:function(d){return b.post("/api/controls/"+d+"/poweron").then(function(a){return c.debug("Called powerOn API for control id:"+d),a.data},function(b){return c.info("Call to "+b.config.url+" failed with status "+b.status),a.reject(b.data)})},powerOff:function(d){return b.post("/api/controls/"+d+"/poweroff").then(function(a){return c.debug("Called powerOff API for control id:"+d),a.data},function(b){return c.info("Call to "+b.config.url+" failed with status "+b.status),a.reject(b.data)})},getState:function(d){return b.get("/api/controls/"+d).then(function(a){return c.debug("Called getState API for control id:"+d),a.data},function(b){return c.info("Call to "+b.config.url+" failed with status "+b.status),a.reject(b.data)})}}}angular.module("ha-remote.panel").service("powerControlService",["$q","$http","$log",a])}(),function(){"use strict";angular.module("ha-remote.authn").factory("Intercept401",["$log","$q","$rootScope",function(a,b,c){return{responseError:function(d){a.debug("Intercepted response error");var e=b.defer();return 401==d.status&&(c.$broadcast("authnFailed"),a.debug("Broadcasted authnFailed event")),e.reject(d),e.promise}}}]),angular.module("ha-remote.authn").config(["$httpProvider",function(a){a.interceptors.push("Intercept401")}])}(),function(){"use strict";angular.module("ha-remote.authn",["LocalStorageModule"]),angular.module("ha-remote.authn").config(["localStorageServiceProvider",function(a){a.setPrefix("HARemote").setStorageType("localStorage").setNotify(!0,!0)}])}(),function(){"use strict";function a(a,b,c,d){function e(b){a.set("AuthToken",b),c.defaults.headers.common.Authorization="Bearer: ".concat(b),d.debug("New token stored")}function f(){a.remove("AuthToken"),d.debug("Token removed")}return{login:function(a){return c.post("/api/authn",{password:a}).then(function(a){d.debug("Sucessfully logged in"),e(a.data.token)},function(a){return 401==a.status?(d.info("Login attempted with invalid credentials"),f(),b.reject(401)):(d.info("Call to "+a.config.url+" failed with status "+a.status),b.reject(a.data))})},logout:function(){f()},isAuthenticated:function(){var b=a.get("AuthToken");return b?(c.defaults.headers.common.Authorization=b,!0):!1}}}angular.module("ha-remote.authn").service("authnService",["localStorageService","$q","$http","$log",a])}(),function(){"use strict";angular.module("ha-remote.translations",["pascalprecht.translate"]);var a={APPNAME:"HA Remote",TITLE:"Home Remote",HEADLINE:"Home Remote",MENU_PANEL:"Buttons",MENU_ABOUT:"About this App",MENU_LOGIN:"Log in",MENU_LOGOUT:"Log out",ALL_CONTROLS:"All at once",POWER_ON_SUCCESS:"{{control_caption}} powered on",POWER_ON_FAILURE:"Failed to power on {{control_caption}}",POWER_OFF_SUCCESS:"{{control_caption}} powered off",POWER_OFF_FAILURE:"Failed to power off {{control_caption}}",POWER_ON_ALL_SUCCESS:"Everything powered on",POWER_ON_ALL_FAILURE:"Could not power everything on",POWER_OFF_ALL_SUCCESS:"Everything powered off",POWER_OFF_ALL_FAILURE:"Could not power everything off",CONFIG_LOAD_FAILED:"Could not load configuration",W_VERSION:"Version",W_MODULES:"Modules",W_PASSWORD:"Password",W_LOGIN:"Login",WRONG_PASSWORD:"Login failed, please try again"},b={APPNAME:"HA Remote",TITLE:"Hemma fjärr",HEADLINE:"Hemma fjärr",MENU_PANEL:"Knappar",MENU_ABOUT:"Om appen",MENU_LOGIN:"Logga in",MENU_LOGOUT:"Logga ut",ALL_CONTROLS:"Alla samtidigt",POWER_ON_SUCCESS:"Tände {{control_caption}}",POWER_ON_FAILURE:"Kunde inte tända {{control_caption}}",POWER_OFF_SUCCESS:"Släckte {{control_caption}}",POWER_OFF_FAILURE:"Kunde inte släcka {{control_caption}}",POWER_ON_ALL_SUCCESS:"Tände alla",POWER_ON_ALL_FAILURE:"Kunde inte tända alla",POWER_OFF_ALL_SUCCESS:"Släckte alla",POWER_OFF_ALL_FAILURE:"Kunde inte släcka alla",CONFIG_LOAD_FAILED:"Kunde inte hämta konfigurationen",W_VERSION:"Version",W_MODULES:"Moduler",W_PASSWORD:"Lösenord",W_LOGIN:"Logga in",WRONG_PASSWORD:"Misslyckad inloggning, försök igen."};angular.module("ha-remote.translations").config(["$translateProvider",function(c){c.translations("en",a).translations("sv",b).fallbackLanguage("en").preferredLanguage("sv"),c.useSanitizeValueStrategy("escape")}])}(),function(){angular.module("window-events",[]).directive("bnWindowBlur",function(a,b){function c(c,d,e){function f(a){c.$apply(e.bnWindowBlur),b.debug("Window blurred.")}function g(){h.off("blur",f)}var h=angular.element(a).on("blur",f);c.$on("$destroy",g)}return{link:c,restrict:"A"}}).directive("bnWindowFocus",function(a,b){function c(c,d,e){function f(){h.off("focus",g)}function g(a){c.$apply(e.bnWindowFocus),b.debug("Window focused.")}var h=angular.element(a).on("focus",g);c.$on("$destroy",f)}return{link:c,restrict:"A"}})}();